<mat-stepper labelPosition="bottom" linear="true" #stepper>
  <ng-template matStepperIcon="number" let-index="index">
    <ng-container [ngSwitch]="index">
      <mat-icon *ngSwitchCase="0">palette</mat-icon>
      <mat-icon *ngSwitchCase="1">payment</mat-icon>
      <mat-icon *ngSwitchCase="2">person</mat-icon>
      <mat-icon *ngSwitchCase="3">account_balance</mat-icon>
      <mat-icon *ngSwitchCase="4">check_circle</mat-icon>
      <mat-icon *ngSwitchDefault>radio_button_unchecked</mat-icon>
    </ng-container>
  </ng-template>

  <mat-step [stepControl]="firstFormGroup">
    <form [formGroup]="firstFormGroup">
      <ng-template matStepLabel>Personalização</ng-template>
      <h1 class="title color-titles poppins-semibold --title-text-24px">
        Personalize seu veículo
      </h1>
      <div class="cores-disponiveis">
        <div *ngFor="let cor of cores" class="cor-opcao" [class.selected]="corSelecionada?.nome === cor.nome" (click)="selecionarCor(cor)">
          <div class="circle" [style.backgroundColor]="cor.codigoCor"></div>
          <span>{{ cor.nome }}</span>
          <p>+ {{ cor.precoAdicional | currency : "BRL" }}</p>
        </div>
      </div>
      <button class="next-btn" mat-button matStepperNext [disabled]="!firstFormGroup.valid">
        Próximo
      </button>
    </form>
  </mat-step>

  <mat-step [stepControl]="secondFormGroup">
    <form [formGroup]="secondFormGroup">
      <ng-template matStepLabel>Forma de Pagamento</ng-template>

      <div class="secondforms-title">
        <h1>Forma de Pagamento</h1>
        <p>Escolha como deseja pagar pelo seu veículo</p>
      </div>

      <div class="payment-options">
        <div class="payment-card" (click)="secondFormGroup.controls['paymentMethod'].setValue('card')" [class.selected]="
            secondFormGroup.controls['paymentMethod'].value === 'card'
          ">
          <mat-icon class="icons">credit_card</mat-icon>
          <h2>Cartão/Transferência</h2>
          <p class="pay-type">Pagamento tradicional</p>
          <span>{{ precoFinal | currency : "BRL" }}</span>
          <p class="pay-last">Seguro e confiável</p>
        </div>

        <div class="payment-card" (click)="secondFormGroup.controls['paymentMethod'].setValue('pix')" [class.selected]="
            secondFormGroup.controls['paymentMethod'].value === 'pix'
          ">
          <mat-icon class="icons">pix</mat-icon>
          <h2>PIX</h2>
          <p class="pay-type">Pagamento com desconto</p>
          <span>{{ precoFinalComDesconto | currency : "BRL" }}</span>
          <p class="pay-pix">5% de desconto</p>
        </div>

        <div class="payment-card" (click)="
            secondFormGroup.controls['paymentMethod'].setValue('financing')
          " [class.selected]="
            secondFormGroup.controls['paymentMethod'].value === 'financing'
          ">
          <mat-icon class="icons">payments</mat-icon>
          <h2>Financiamento</h2>
          <p class="pay-type">Até 60x</p>
          <span>{{ precoFinal / 60 | currency : "BRL" }} / mês</span>
          <p class="pay-last">Parcele em até 60x</p>
        </div>
      </div>

      <mat-error *ngIf="
          secondFormGroup.controls['paymentMethod'].hasError('required') &&
          secondFormGroup.controls['paymentMethod'].touched
        ">
        Por favor, selecione uma forma de pagamento.
      </mat-error>

      <div *ngIf="secondFormGroup.get('paymentMethod')?.value === 'financing'" formGroupName="financingDetails" class="financing-form">
        <div class="flex-bg">
          <div class="title-second-inputs">
            <mat-icon class="icons-second-input">calculate</mat-icon>
            <h1>Configurar Financiamento</h1>
          </div>

          <div class="flex-container">
            <div class="first-input-secondgroup">
              <h2>Valor de entrada</h2>
              <mat-form-field class="container-inputs">
                <mat-label class="label">Digite o valor da entrada</mat-label>
                <input class="inputs" matInput formControlName="downPayment" type="number" placeholder="Ex: 50000" />
              </mat-form-field>
              <p>
                Valor minimo de 15%, valor recomendado de 20% do valor total
              </p>
            </div>

            <div class="second-input-secondgroup">
              <h2>Número de Parcelas</h2>
              <mat-form-field class="container-inputs">
                <mat-label class="label">Número de Parcelas</mat-label>
                <input matInput formControlName="installments" type="number" placeholder="Ex: 60" />
              </mat-form-field>
              <p>Taxas preferenciais para até 60 parcelas</p>
            </div>
          </div>
        </div>
      </div>
    </form>
    <div class="buttons-nav">
      <button class="voltar" mat-button matStepperPrevious>
        <mat-icon style="color: var(--text-title)">arrow_back</mat-icon>
        Voltar
      </button>
      <button class="proximo" mat-button matStepperNext [disabled]="!secondFormGroup.valid" [ngClass]="{ disabled: !secondFormGroup.valid }">
        Próximo
      </button>
    </div>
  </mat-step>

  <mat-step [stepControl]="threeFormGroup">
    <form [formGroup]="threeFormGroup">
      <ng-template matStepLabel>Dados Pessoais</ng-template>
      <div class="threeformtitle">
        <h1 class="poppins-semibold --title-text-24px color-titles">
          Dados Pessoais
        </h1>
        <p class="poppins-regular --text-16px" style="color: var(--text-color-two)">
          Precisamos dessas informações para finalizar a compra
        </p>
      </div>

      <div class="grid-list">
        <div class="column-1">
          <div class="name-forms forms-width">
            <h3>Nome completo*</h3>
            <mat-form-field>
              <mat-label>Seu Nome Completo</mat-label>
              <input matInput formControlName="nome_completo" placeholder="Ex. Uelisson Silva" required />
            </mat-form-field>
            <mat-error *ngIf="
                threeFormGroup.get('nome_completo')?.invalid &&
                (threeFormGroup.get('nome_completo')?.touched ||
                  threeFormGroup.get('nome_completo')?.dirty)
              ">
              <span *ngIf="
                  threeFormGroup.get('nome_completo')?.hasError('required')
                ">
                Por favor, digite um nome!
              </span>
              <span *ngIf="
                  threeFormGroup.get('nome_completo')?.hasError('minlength')
                ">
                O nome deve conter ao menos 3 caracteres.
              </span>
            </mat-error>
          </div>

          <div class="email forms-width">
            <h3>Email*</h3>
            <div>
              <mat-form-field>
                <mat-label>Digite seu email</mat-label>
                <input matInput placeholder="email@example.com" formControlName="email" required />
              </mat-form-field>

              <mat-error *ngIf="
                  threeFormGroup.get('email')?.invalid &&
                  (threeFormGroup.get('email')?.touched ||
                    threeFormGroup.get('email')?.dirty)
                ">
                <span *ngIf="threeFormGroup.get('email')?.hasError('required')">
                  Por favor, digite um email!
                </span>
                <span *ngIf="threeFormGroup.get('email')?.hasError('email')">
                  Porfavor digite um email valido!
                </span>
              </mat-error>
            </div>
          </div>

          <div class="rg forms-width">
            <h3>RG*</h3>
            <div>
              <mat-form-field>
                <mat-label>Digite o seu Rg</mat-label>
                <input matInput type="number" placeholder="00.000.000-0" formControlName="rg" required />
              </mat-form-field>

              <mat-error *ngIf="
                  threeFormGroup.get('rg')?.invalid &&
                  (threeFormGroup.get('rg')?.touched ||
                    threeFormGroup.get('rg')?.dirty)
                ">
                <span *ngIf="threeFormGroup.get('rg')?.hasError('required')">
                  Por favor, digite seu rg!
                </span>
              </mat-error>
            </div>
          </div>
        </div>

        <div class="column-2">
          <div class="cpf forms-width">
            <h3>CPF*</h3>
            <div>
              <mat-form-field>
                <mat-label>Digite o seu cpf</mat-label>
                <input matInput placeholder="000.000.000-00" formControlName="cpf" required />
              </mat-form-field>

              <mat-error *ngIf="
                  threeFormGroup.get('cpf')?.invalid &&
                  (threeFormGroup.get('cpf')?.touched ||
                    threeFormGroup.get('cpf')?.dirty)
                ">
                <span *ngIf="threeFormGroup.get('cpf')?.hasError('required')">
                  Por favor, digite seu cpf!
                </span>
                <span *ngIf="threeFormGroup.get('cpf')?.hasError('cpfInvalido')">
                  digite um cpf valido.
                </span>
              </mat-error>
            </div>
          </div>

          <div class="telefone forms-width">
            <h3>Telefone*</h3>
            <div>
              <mat-form-field>
                <mat-label>Digite o seu telefone</mat-label>
                <input matInput appPhoneMask placeholder="(71) 99999-9999" formControlName="telefone" required />
              </mat-form-field>

              <mat-error *ngIf="
                  threeFormGroup.get('telefone')?.invalid &&
                  (threeFormGroup.get('telefone')?.touched ||
                    threeFormGroup.get('telefone')?.dirty)
                ">
                <span *ngIf="threeFormGroup.get('telefone')?.hasError('required')">
                  Por favor, digite seu telefone!
                </span>
                <span *ngIf="
                    threeFormGroup.get('telefone')?.hasError('telefoneInvalido')
                  ">
                  Por favor, digite um telefone valido.
                </span>
              </mat-error>
            </div>
          </div>

          <div class="renda forms-width">
            <h3>Renda Mensal*</h3>
            <div>
              <mat-form-field>
                <input matInput type="number" class="example-right-align" placeholder="0" formControlName="renda" required />
                <span matTextPrefix>R$&nbsp;</span>
                <span matTextSuffix>,00</span>
              </mat-form-field>

              <mat-error *ngIf="
                  threeFormGroup.get('renda')?.invalid &&
                  (threeFormGroup.get('renda')?.touched ||
                    threeFormGroup.get('renda')?.dirty)
                ">
                <span *ngIf="threeFormGroup.get('renda')?.hasError('required')">
                  Por favor, digite seu rg!
                </span>
              </mat-error>
            </div>
          </div>
        </div>
      </div>
      <div class="adress-forms">
        <h4 class="color-titles --text-16px poppins-medium ">Endereço de Enrega</h4>
        <div class="adress-flex-container">
          <div class="cep">
            <h3>Cep*</h3>
            <div>
              <mat-form-field>
                <input matInput appCepMask placeholder="000000-000" formControlName="cep" required />
              </mat-form-field>
              <mat-error *ngIf="
                  threeFormGroup.get('cep')?.invalid &&
                  (threeFormGroup.get('cep')?.touched ||
                    threeFormGroup.get('cep')?.dirty)
                ">
                <span *ngIf="threeFormGroup.get('cep')?.hasError('required')">
                  Por favor, digite seu cep!
                </span>
                <span *ngIf="
                    threeFormGroup.get('cep')?.hasError('cepNaoEncontrado')
                  ">
                  digite um cep valido.
                </span>
              </mat-error>
            </div>
          </div>

          <div class="adress">
            <h3>Endereço*</h3>
            <div>
              <mat-form-field>
                <input matInput placeholder="Rua, número, complemento" formControlName="endereco" required />
              </mat-form-field>
            </div>
          </div>

          <div class="city">
            <h3>Cidade*</h3>
            <div>
              <mat-form-field>
                <input matInput placeholder="Sua cidade" formControlName="cidade" required />
              </mat-form-field>
            </div>
          </div>
        </div>

      </div>
    </form>

    <div class="buttons-nav">
      <button class="voltar" mat-button matStepperPrevious>
        <mat-icon style="color: var(--text-title)">arrow_back</mat-icon>
        Voltar
      </button>
      <button class="proximo" mat-button matStepperNext [disabled]="!threeFormGroup.valid" [ngClass]="{ disabled: !threeFormGroup.valid }">
        Próximo
      </button>
    </div>
  </mat-step>

  <mat-step [stepControl]="fourFormGroup">
    <form [formGroup]="fourFormGroup">
      <ng-template matStepLabel>Dados Bancários</ng-template>
      <mat-form-field>
        <mat-label>Sua Agência e Conta</mat-label>
        <input matInput formControlName="fourCtrl" placeholder="Ex. Ag 0001, C/C 12345-6" required />
      </mat-form-field>
      <div>
        <button mat-button matStepperPrevious>Voltar</button>
        <button mat-button matStepperNext>Próximo</button>
      </div>
    </form>
  </mat-step>

  <mat-step>
    <ng-template matStepLabel>Confirmação</ng-template>
    <p>Você finalizou o processo. Revise os dados e confirme sua compra!</p>
    <div>
      <button mat-button matStepperPrevious>Voltar</button>
      <button mat-button (click)="stepper.reset()">Finalizar Compra</button>
    </div>
  </mat-step>
</mat-stepper>